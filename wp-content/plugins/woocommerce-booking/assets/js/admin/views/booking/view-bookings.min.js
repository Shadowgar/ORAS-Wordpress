var view_bookings=Vue.component("tab-view-bookings",{template:"#view-bookings-tab",data:()=>({data:{label:{loading_loader:bkap_params.vue.label.loading_loader,print_loader:bkap_view_view_bookings_param.label.print_loader,csv_loader:bkap_view_view_bookings_param.label.csv_loader,updating_booking_loader:bkap_view_view_bookings_param.label.updating_booking_loader},settings:Object.assign({done_typing_interval:500,typing_timer:{}},bkap_view_view_bookings_param.data),edit_booking:{data:{booking_id:"",booking_text:"",order_url:"",order_id:"",order_number:"",date_created:"",booking_status:"",product_name:"",quantity:"",total:"",timezone:[],zoom_meeting:[],start_date_label:"",start_date:"",end_date_label:"",end_date:"",booking_comment:""}},reminder:{reminder_id:0,sending_reminder:!1},bookings:[],toggle_edit_mode:{manage_availability:!1}},show_loading_loader:!1,show_edit_booking_page:!1,show_updating_booking_loader:!1}),mounted(){tyche.bkap.view_bookings.table.init(this),this.init_search();let hidden_columns=this.data.settings.view_booking_hidden_columns;setTimeout(()=>{hidden_columns.forEach(column_value=>{jQuery(`.column-${column_value}`).addClass("hidden")})},1e3)},methods:{init_search(){let $this=this;tyche.bkap.choices_js.render_choices_js_elements("view_bookings_customer_search",[],".view_bookings_customer_search",!0,!1,{placeholder:!0,loadingText:"Searching ...",placeholderValue:"Search Customers",noChoicesText:"No matches found",searchPlaceholderValue:"Search Customers",removeItemButton:!0,itemSelectText:"",searchEnabled:!0}),tyche.bkap.choices_js.instances.view_bookings_customer_search.passedElement.element.addEventListener("search",function(event){tyche.bkap.choices_js.instances.view_bookings_customer_search.setChoices([{value:"",label:"Loading...",disabled:!0}],"value","label",!0),clearTimeout($this.data.settings.typing_timer),$this.data.settings.typing_timer=setTimeout(function(){let search_term=event.detail.value;axios.post(`${tyche.bkap.rest_url()}view-bookings/search-customer`,{search_term:search_term},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data&&"success"===response.data.type&&tyche.bkap.choices_js.render_choices_js_elements("view_bookings_customer_search",response.data.data,".view_bookings_customer_search",!0)})},$this.data.settings.done_typing_interval)})},save_booking(){let $this=this;$this.show_updating_booking_loader=!0;let update_data={booking_id:$this.data.edit_booking.data.booking_id,product_id:$this.data.edit_booking.data.product_id,wapbk_hidden_date:jQuery("#wapbk_hidden_date").val(),wapbk_hidden_date_checkout:jQuery("#wapbk_hidden_date_checkout").val(),time_slot:jQuery("#time_slot").val(),duration_time_slot:jQuery("#duration_time_slot").val(),bkap_duration_field:jQuery("#bkap_duration_field").val(),quantity:jQuery("#bkap_qty").val(),status:jQuery("#edit_booking_status").val(),selected_duration:"",bkap_price_charged:jQuery("#bkap_price_charged").val(),bkap_front_resource_selection:jQuery("#bkap_front_resource_selection").val()};if(jQuery('input[id^="bkap_field_persons_"]').length>0){let person_ids=[],total_person=0;jQuery(MODAL_FORM_ID+"#bkap_field_persons").length>0?(person_id=1,person_val=jQuery(MODAL_FORM_ID+"#bkap_field_persons").val(),""==person_val&&(person_val=0),total_person=parseInt(person_val),person_ids.push({person_id:person_id,person_val:person_val})):jQuery('input[id^="bkap_field_persons_"]').each(function(i,row){let person_id=jQuery(this)[0].id.split("_")[3],person_val=jQuery(this).val();""==person_val&&(person_val=0),total_person+=parseInt(person_val),person_ids.push({person_id:person_id,person_val:person_val})}),jQuery.extend(update_data,{bkap_field_persons:person_ids})}axios.post(`${tyche.bkap.rest_url()}view-bookings/update-booking`,update_data,{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?(tyche.bkap.notification(response.data.message,"success"),$this.show_updating_booking_loader=!1):"error"===response.data.type&&(tyche.bkap.notification(response.data.error_description,"alert"),$this.show_updating_booking_loader=!1):(tyche.bkap.notification(tyche.bkap.return_label("axios_get_error"),"alert"),$this.show_updating_booking_loader=!1)}).catch(function(error){tyche.bkap.notification(tyche.bkap.return_label("axios_get_error",error),"alert"),$this.show_updating_booking_loader=!1})},bkap_add_zoom_meeting(){let $this=this;$this.show_updating_booking_loader=!0,axios.post(`${tyche.bkap.rest_url()}zoom/add-zoom-meeting`,{booking_id:$this.data.edit_booking.data.booking_id,meeting_link:$this.data.edit_booking.data.zoom_meeting.new_zoom_link},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?(tyche.bkap.notification(response.data.message,"success"),jQuery("#bkap_add_zoom_meeting").html(response.data.meeting_link),jQuery("#bkap_add_zoom_meeting_link").hide(),jQuery("#bkap_manual_zoom_meeting").hide(),jQuery("#bkap_manual_zoom_meeting_info").hide(),$this.show_updating_booking_loader=!1):"error"===response.data.type&&(tyche.bkap.notification(response.data.error_description,"alert"),$this.show_updating_booking_loader=!1):(tyche.bkap.notification(tyche.bkap.return_label("axios_get_error"),"alert"),$this.show_updating_booking_loader=!1)}).catch(function(error){tyche.bkap.notification(tyche.bkap.return_label("axios_get_error",error),"alert"),$this.show_updating_booking_loader=!1})},close(){jQuery("#view-bookings-search").trigger("click"),this.show_edit_booking_page=!1},bkap_send_reminder_manually(reminder_id,booking_id){let $this=this;$this.data.reminder.sending_reminder=!0,axios.post(`${tyche.bkap.rest_url()}reminders/send-manual-booking-reminder`,{reminder_id:reminder_id,booking_id:booking_id},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?(tyche.bkap.notification(response.data.message,"success"),$this.data.reminder.sending_reminder=!1):"error"===response.data.type&&(tyche.bkap.notification(response.data.error_description,"alert"),$this.data.reminder.sending_reminder=!1):(tyche.bkap.notification(tyche.bkap.return_label("axios_get_error"),"alert"),$this.data.reminder.sending_reminder=!1)}).catch(function(error){tyche.bkap.notification(tyche.bkap.return_label("axios_get_error",error),"alert"),$this.data.reminder.sending_reminder=!1})},bkap_search_bookings(){jQuery("#view-bookings-search").trigger("click")},bkap_add_bookings_to_gcal(){let $this=this;$this.show_loading_loader=!0,axios.post(`${tyche.bkap.rest_url()}view-bookings/add-to-google-calendar`,{user_id:$this.data.settings.add_to_google_calendar.user_id},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?(tyche.bkap.notification(response.data.message,"success"),$this.show_loading_loader=!1):"error"===response.data.type&&(tyche.bkap.notification(response.data.error_description,"alert"),$this.show_loading_loader=!1):(tyche.bkap.notification(tyche.bkap.return_label("axios_get_error"),"alert"),$this.show_loading_loader=!1)}).catch(function(error){tyche.bkap.notification(tyche.bkap.return_label("axios_get_error",error),"alert"),$this.show_loading_loader=!1})},bkap_save_screen_options(){let $this=this,view_booking_hidden_columns=$this.data.settings.view_booking_hidden_columns,view_booking_items=$this.data.settings.view_booking_items,user_id=$this.data.settings.user_id;$this.show_loading_loader=!0,axios.post(`${tyche.bkap.rest_url()}view-bookings/save-screen-options`,{view_booking_hidden_columns:view_booking_hidden_columns,view_booking_items:view_booking_items,user_id:user_id},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?(tyche.bkap.view_bookings.table.display({page:parseInt(jQuery(".view-bookings-table input[name=paged]").val())||"1",order:jQuery(".view-bookings-table input[name=order]").val()||"desc",orderby:jQuery(".view-bookings-table input[name=orderby]").val()||"ID",search:jQuery(".view-bookings-table #search-view-bookings-search-input").val(),filter:tyche.bkap.view_bookings.table.__filter(),status:jQuery(".view-bookings-table input[name=booking_status]").val()||"all"}),tyche.bkap.notification(response.data.message,"success"),$this.show_loading_loader=!1):"error"===response.data.type&&(tyche.bkap.notification(response.data.error_description,"alert"),$this.show_loading_loader=!1):(tyche.bkap.notification(tyche.bkap.return_label("axios_get_error"),"alert"),$this.show_loading_loader=!1)}).catch(function(error){tyche.bkap.notification(tyche.bkap.return_label("axios_get_error",error),"alert"),$this.show_loading_loader=!1})},bkap_show_hide_view_booking_column(column_value){let $this=this,v_columns=$this.data.settings.view_booking_hidden_columns;v_columns.includes("bkap_"+column_value)?($this.data.settings.view_booking_hidden_columns=v_columns.filter(item=>item!=="bkap_"+column_value),jQuery(`.column-${column_value}`).removeClass("hidden")):($this.data.settings.view_booking_hidden_columns.push("bkap_"+column_value),jQuery(`.column-${column_value}`).addClass("hidden"))}}});
