var booking_calendar=Vue.component("tab-booking-calendar",{template:"#booking-calendar-tab",data:()=>({data:{settings:{done_typing_interval:2e3,product_id:[],typing_timer:{}},label:{loading_calendar_events:bkap_view_booking_calendar_param.loading_calendar_events},bkap_fullcalendar:{}}}),mounted(){this.init_calendar_search_product_select_box();let $this=this;document.addEventListener("DOMContentLoaded",function(){$this.init_calendar()}),jQuery(document).on("click",".secondary-nav-wrap ul li",function(){"Calendar "===jQuery(this).find("a").html()&&$this.init_calendar()})},methods:{init_calendar_search_product_select_box(){let $this=this;tyche.bkap.choices_js.render_choices_js_elements("booking_calendar_product_search",[],".booking_calendar_product_search",!0),tyche.bkap.choices_js.instances.booking_calendar_product_search.passedElement.element.addEventListener("search",function(event){tyche.bkap.choices_js.instances.booking_calendar_product_search.setChoices([{value:"",label:"Loading...",disabled:!0}],"value","label",!0),clearTimeout($this.data.settings.typing_timer),$this.data.settings.typing_timer=setTimeout(function(){let search_term=event.detail.value;axios.post(`${tyche.bkap.rest_url()}create-booking/search-product`,{search_term:search_term},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data&&"success"===response.data.type&&tyche.bkap.choices_js.render_choices_js_elements("booking_calendar_product_search",response.data.data,".booking_calendar_product_search",!0)})},$this.data.settings.done_typing_interval)})},filter_calendar_data_by_product(){let product_ids=this.data.settings.product_id,bkap_vendor_id=void 0!==bkap_view_booking_calendar_param.bkap_vendor_id?bkap_view_booking_calendar_param.bkap_vendor_id:"";eventSource=this.data.bkap_fullcalendar.getEventSources(),eventSource[0].remove(),this.data.bkap_fullcalendar.addEventSource("?bkapc_events=json"+bkap_vendor_id+"&product_ids="+product_ids)},init_calendar(){var daymaxevents=parseInt(bkap_view_booking_calendar_param.daymaxevents);isNaN(daymaxevents)&&(daymaxevents=!0),this.data.bkap_fullcalendar=new FullCalendar.Calendar(document.getElementById("bkap-calendar"),{initialView:bkap_view_booking_calendar_param.initialview,slotMinTime:bkap_view_booking_calendar_param.timeslots[0],slotMaxTime:bkap_view_booking_calendar_param.timeslots[1],headerToolbar:JSON.parse(bkap_view_booking_calendar_param.headertoolbar),timeZone:"UTC",navLinks:!0,dayMaxEvents:daymaxevents,events:"?bkapc_events=json"+(void 0!==bkap_view_booking_calendar_param.bkap_vendor_id?"&vendor_id="+bkap_view_booking_calendar_param.bkap_vendor_id:""),locale:bkap_view_booking_calendar_param.lang,loading:function(isLoading,view){let loader=jQuery("#bkap_events_loader");1==isLoading?loader.show():loader.hide()},eventDidMount:function(info){"grey"===info.backgroundColor?jQuery(info.el).on("click",function(){let title=info.event._def.title,date=info.event._instance.range,start_date=(date.start.getMonth()>8?date.start.getMonth()+1:"0"+(date.start.getMonth()+1))+"/"+(date.start.getDate()>9?date.start.getDate():"0"+date.start.getDate())+"/"+date.start.getFullYear().toString().substr(-2);date.end.setDate(date.end.getDate()-1);let end_date=(date.end.getMonth()>8?date.end.getMonth()+1:"0"+(date.end.getMonth()+1))+"/"+(date.end.getDate()>9?date.end.getDate():"0"+date.end.getDate())+"/"+date.end.getFullYear().toString().substr(-2);jQuery("#availability-start").datepicker("setDate",start_date),jQuery("#availability-end").datepicker("setDate",end_date),jQuery(".title").val(title),jQuery(".update-type").val("edit"),jQuery(".update-id").val(info.event.id),jQuery(".popup-overlay, .popup-content").addClass("active")}):jQuery(info.el).qtip({content:{text:bkap_view_booking_calendar_param.loading,button:bkap_view_booking_calendar_param.tip_close,ajax:{url:bkap_view_booking_calendar_param.ajaxurl,type:"POST",data:{action:"bkap_booking_calender_content",order_id:info.event.id,event_value:info.event.extendedProps.value}}},show:{event:"click",solo:!0},position:{my:"bottom right",at:"top right"},hide:"unfocus",style:{classes:"qtip-light qtip-shadow"}})}}),this.data.bkap_fullcalendar.render()}},updated(){this.init_calendar_search_product_select_box()}});
