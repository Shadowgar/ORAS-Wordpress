var google_calendar=Vue.component("tab-google-calendar",{template:"#google-calendar-tab",data:()=>({data:{settings:{bkap_calendar_oauth_integration:{},bkap_calendar_details_1:{},calendars:{}},label:{saving_loader:bkap_params.vue.label.saving_loader,loading_loader:bkap_params.vue.label.loading_loader,save_settings:bkap_params.vue.label.save_settings,imported_success_message:bkap_view_google_calendar_param.label.imported_success_message,imported_error_message:bkap_view_google_calendar_param.label.imported_error_message,logout_from_calendar_loader:bkap_view_google_calendar_param.label.logout_from_calendar_loader,logout_from_google_calendar:bkap_view_google_calendar_param.label.logout_from_google_calendar,connect_to_google_calendar:bkap_view_google_calendar_param.label.connect_to_google_calendar}},show_saved_message:!1,show_error_message:!1,show_saving_loader:!1,show_ics_url_message:!1,show_loading_loader:!0,show_inline_loader_gcal:!1,show_test_loader_gcal:!1,ajax_error:!1,error_message:"",test_connection_message:"",json_file_upload_message:"",json_file_data:{},ics_url_message:"",show_instructions_oauth:!1,show_instructions_directly:!1,show_instructions_import_events:!1,show_imported_success_message:!1,show_imported_error_message:!1,show_logout_from_calendar_loader:!1}),mounted(){this.data.settings=bkap_view_google_calendar_param.data,this.show_loading_loader=!1},methods:{handle_file_change(event){this.reset(),this.show_inline_loader_gcal=!0;let $this=this;const file=event.target.files[0];if(file&&"application/json"===file.type){const reader=new FileReader;reader.onload=()=>{void 0!==JSON.parse(reader.result).private_key&&(this.json_file_data={bkap_calendar_json_data:reader.result,product_id:0,name:file.name})},reader.readAsText(file)}else $this.json_file_upload_message="Invalid file. Please upload JSON File.",setInterval(()=>{$this.json_file_upload_message=""},3e3)},upload_json(){$this=this;const jsonFileInput=this.$refs.jsonFileInput;0==Object.keys(this.json_file_data).length?($this.json_file_upload_message="Please upload the JSON File.",setInterval(()=>{$this.json_file_upload_message=""},3e3)):axios.post(`${tyche.bkap.rest_url()}google-calendar/save-json`,{bkap_calendar_json_data:this.json_file_data.bkap_calendar_json_data,product_id:0,name:$this.json_file_data.name},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data.type&&"success"===response.data.type?($this.show_inline_loader_gcal=!1,$this.data.settings.bkap_calendar_details_1.bkap_calendar_json_file_name=response.data.bkap_calendar_json_file_name,$this.data.settings.bkap_calendar_details_1.bkap_calendar_service_acc_email_address=response.data.bkap_calendar_service_acc_email_address,$this.json_file_upload_message=response.data.message):($this.json_file_upload_message=response.data.error_description,$this.show_inline_loader_gcal=!1),setInterval(()=>{$this.json_file_upload_message=""},3e3),jsonFileInput.value=null}).catch(function(error){$this.json_file_upload_message=tyche.bkap.return_label("axios_get_error",error),$this.show_inline_loader_gcal=!1,setInterval(()=>{$this.json_file_upload_message=""},3e3),jsonFileInput.value=null})},remove_json(){$this=this,axios.post(`${tyche.bkap.rest_url()}google-calendar/remove-json`,{product_id:0},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data.type&&"success"===response.data.type?($this.show_inline_loader_gcal=!1,$this.data.settings.bkap_calendar_details_1.bkap_calendar_json_file_name="",$this.data.settings.bkap_calendar_details_1.bkap_calendar_service_acc_email_address="",$this.json_file_data={},$this.json_file_upload_message=response.data.message):($this.json_file_upload_message=response.data.error_description,$this.show_inline_loader_gcal=!1),setInterval(()=>{$this.json_file_upload_message=""},3e3)}).catch(function(error){$this.json_file_upload_message=tyche.bkap.return_label("axios_get_error",error),$this.show_inline_loader_gcal=!1,setInterval(()=>{$this.json_file_upload_message=""},3e3)}),this.$refs.jsonFileInput.value=null},reset(){this.show_saved_message=!1,this.show_error_message=!1,this.show_ics_url_message=!1,this.show_saving_loader=!1,this.show_loading_loader=!1,this.show_inline_loader_gcal=!1,this.show_test_loader_gcal=!1,this.ajax_error=!1,this.error_message="",this.test_connection_message="",this.ics_url_message="",this.show_instructions_oauth=!1,this.show_instructions_directly=!1,this.show_instructions_import_events=!1,this.show_imported_success_message=!1,this.show_imported_error_message=!1,this.show_logout_from_calendar_loader=!1,this.data.settings.bkap_gcal_success=""},save_settings(){this.reset(),this.show_saving_loader=!0;let $this=this;axios.post(`${tyche.bkap.rest_url()}google-calendar/save`,{data:$this.data.settings},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data&&"success"===response.data.type?($this.show_saving_loader=!1,$this.show_saved_message=!0,$this.data.settings=response.data.data):($this.error_message=tyche.bkap.return_label("axios_get_error"),$this.show_saving_loader=!1,$this.show_error_message=!0)}).catch(function(error){$this.error_message=tyche.bkap.return_label("axios_get_error",error),$this.show_saving_loader=!1,$this.show_error_message=!0}),document.getElementById("bkap-page").scrollIntoView({behavior:"smooth",block:"start"})},toggle_display(e){void 0!==this[e]&&(this[e]=!this[e])},test_gcal_connection(){this.reset(),this.show_test_loader_gcal=!0;let $this=this;axios.post(`${tyche.bkap.rest_url()}google-calendar/test-connection`,{},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data.type&&"success"===response.data.type?($this.show_test_loader_gcal=!1,$this.test_connection_message=response.data.message):($this.test_connection_message=tyche.bkap.return_label("axios_get_error"),$this.show_test_loader_gcal=!1)}).catch(function(error){$this.test_connection_message=tyche.bkap.return_label("axios_get_error",error),$this.show_test_loader_gcal=!1})},save_ics_url(row){this.reset();let $this=this;if(""===row.url)return $this.show_ics_url_message=!0,void($this.ics_url_message=bkap_view_google_calendar_param.label.ics_url_is_empty_message);axios.post(`${tyche.bkap.rest_url()}google-calendar/save-ics-urls`,{ics_urls:$this.data.settings.bkap_ics_feed_urls,product_id:0},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){if(void 0!==response.data.type&&"success"===response.data.type){let urls=response.data.bkap_ics_feed_urls;Array.isArray(urls)&&urls.length>0&&urls.forEach(function(item,index){Vue.set($this.data.settings.bkap_ics_feed_urls,index,item)}),$this.show_ics_url_message=!0,$this.ics_url_message=bkap_view_google_calendar_param.label.save_ics_url_success_message}else $this.ics_url_message=tyche.bkap.return_label("axios_get_error"),$this.show_ics_url_message=!0}).catch(function(error){$this.ics_url_message=tyche.bkap.return_label("axios_get_error",error),$this.show_ics_url_message=!1})},import_ics_event(id){this.reset();let $this=this;$this.data.settings.bkap_ics_feed_urls[id].is_importing=!0,axios.post(`${tyche.bkap.rest_url()}google-calendar/import-event`,{id:id,product_id:0},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data.type?"success"===response.data.type?($this.show_imported_success_message=!0,$this.data.settings.bkap_ics_feed_urls[id].save=!1,$this.data.settings.bkap_ics_feed_urls[id].import=!1,$this.data.settings.bkap_ics_feed_urls[id].delete=!0,$this.data.settings.bkap_ics_feed_urls[id].is_importing=!1):"error"===response.data.type&&(tyche.bkap.notification(response.data.error_description,"alert"),$this.data.settings.bkap_ics_feed_urls[id].import=!0,$this.data.settings.bkap_ics_feed_urls[id].delete=!0,$this.data.settings.bkap_ics_feed_urls[id].is_importing=!1):($this.show_imported_error_message=!0,$this.data.settings.bkap_ics_feed_urls[id].is_importing=!1)}).catch(function(){$this.show_imported_error_message=!0,$this.data.settings.bkap_ics_feed_urls[id].is_importing=!1})},delete_ics_url(row,id){let url=row.url;this.data.settings.bkap_ics_feed_urls.splice(id,1),""!==url&&this.save_ics_url(row)},add_new_ics_url(){this.data.settings.bkap_ics_feed_urls.push({url:"",save:!0,import:!1,delete:!0,is_importing:!1})},logout_from_google_calendar(){this.reset();let $this=this;$this.show_logout_from_calendar_loader=!0,axios.post(`${tyche.bkap.rest_url()}google-calendar/logout-google-calendar`,{product_id:0},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data.type&&"success"===response.data.type?(tyche.bkap.notification(response.data.message,"success"),$this.data.settings=response.data.data,$this.show_logout_from_calendar_loader=!1):(tyche.bkap.notification(tyche.bkap.return_label("axios_get_error",error),"alert"),$this.show_logout_from_calendar_loader=!1)}).catch(function(){tyche.bkap.notification(tyche.bkap.return_label("axios_get_error",error),"alert"),$this.show_logout_from_calendar_loader=!1})}}});
