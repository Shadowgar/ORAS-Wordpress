var manual_reminder=Vue.component("tab-manual-reminder",{template:"#manual-reminder-tab",data:()=>({data:{label:{loading_loader:bkap_params.vue.label.loading_loader,sending_manual_reminder_loader:bkap_view_manual_reminder_param.label.sending_manual_reminder_loader,saving_manual_reminder_draft:bkap_view_manual_reminder_param.label.saving_manual_reminder_draft},settings:{},manual_reminder_data:{send_reminder_for:"",order_ids:[],booking_ids:[],product_ids:[],email_subject:"",email_content:""},wp_editor_data:"",fn:tyche.bkap.metabox.booking},show_loading_loader:!0,sending_manual_reminder_loader:!1,saving_manual_reminder_draft:!1}),mounted(){const $this=this;$this.data.settings=bkap_view_manual_reminder_param.data,$this.data.manual_reminder_data.email_subject=bkap_view_manual_reminder_param.data.manual_reminder_email_subject,$this.wp_editor_content(),$this.init_choices(),setTimeout(function(){$this.show_loading_loader=!1},2e3)},methods:{wp_editor_content(){const $this=this;jQuery(window).on("load",function(){const frag=document.querySelector("#reminders-tab").content.cloneNode(!0);$this.data.wp_editor_data=jQuery(frag.children[0]).find("div#bkap_wp_editor_email_content").html(),tyche.bkap.reminders.table.render_manual_reminder_page_data($this)})},init_choices(){setTimeout(function(){void 0!==tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_order&&(tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_order.destroy(),delete tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_order),tyche.bkap.choices_js.render_choices_js_elements("manual_reminder_send_reminder_for_order",[],".manual_reminder_send_reminder_for_order",!1,!1),void 0!==tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_booking&&(tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_booking.destroy(),delete tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_booking),tyche.bkap.choices_js.render_choices_js_elements("manual_reminder_send_reminder_for_booking",[],".manual_reminder_send_reminder_for_booking",!1,!1),void 0!==tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_product&&(tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_product.destroy(),delete tyche.bkap.choices_js.instances.manual_reminder_send_reminder_for_product),tyche.bkap.choices_js.render_choices_js_elements("manual_reminder_send_reminder_for_product",[],".manual_reminder_send_reminder_for_product",!1,!1)},500)},save_reminder_as_draft(){this.send_email_reminder(!0)},send_email_reminder(is_draft=!1){const $this=this,loader=is_draft?"saving_manual_reminder_draft":"sending_manual_reminder_loader";$this[loader]=!0;let data=$this.data.manual_reminder_data;data.email_content=jQuery("#email_content_ifr").contents().find("body").html(),is_draft&&(data.is_draft="yes"),axios.post(`${tyche.bkap.rest_url()}reminders/send-manual-reminder`,{data:data},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?(is_draft||($this.data.manual_reminder_data={send_reminder_for:"",order_ids:[],booking_ids:[],product_ids:[],email_subject:"",email_content:""},jQuery("#email_content_ifr").contents().find("body").html(""),$this.init_choices()),$this[loader]=!1,tyche.bkap.notification(response.data.message,"success")):"error"===response.data.type&&(tyche.bkap.notification(response.data.error_description,"alert"),$this[loader]=!1):(tyche.bkap.notification(tyche.bkap.return_label("axios_get_error"),"alert"),$this[loader]=!1)}).catch(function(error){tyche.bkap.notification(tyche.bkap.return_label("axios_get_error",error),"alert"),$this[loader]=!1})}}});
