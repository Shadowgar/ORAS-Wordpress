var seasonal_pricing=Vue.component("tab-seasonal-pricing",{template:"#seasonal-pricing-tab",data:()=>({data:{settings:{},label:{saving_loader:bkap_params.vue.label.saving_loader,loading_loader:bkap_params.vue.label.loading_loader,save_settings:bkap_params.vue.label.save_settings},plugin_not_activated_message:bkap_view_seasonal_pricing_param.plugin_not_activated_message,add_season_data:{},wp_roles:{},wc_currency_args:{},add_season_data:{amount_or_percent:"percent",operator:"add",season_name:"",user_role:[],start_date:"",end_date:"",price:"",years:1}},show_saved_message:!1,show_error_message:!1,show_saving_loader:!1,show_loading_loader:!0,show_add_season_data_page:!1,ajax_error:!1,error_message:"",show_season_data_saved_message:!1,show_season_data_updated_message:!1,show_season_data_deleted_message:!1}),mounted(){this.data.settings=bkap_view_seasonal_pricing_param.data,this.data.wp_roles=bkap_view_seasonal_pricing_param.wp_roles,this.data.wc_currency_args=bkap_view_seasonal_pricing_param.wc_currency_args,this.show_loading_loader=!1},methods:{reset(){this.show_saved_message=!1,this.show_error_message=!1,this.show_saving_loader=!1,this.show_loading_loader=!1,this.ajax_error=!1,this.error_message="",this.show_add_season_data_page=!1,this.show_season_data_saved_message=!1,this.show_season_data_updated_message=!1,this.show_season_data_deleted_message=!1},reset_season_data(){this.data.add_season_data={amount_or_percent:"percent",operator:"add",season_name:"",user_role:[],start_date:"",end_date:"",price:"",years:1}},save_settings(){this.reset(),this.show_saving_loader=!0;let $this=this;axios.post(`${tyche.bkap.rest_url()}seasonal-pricing/save`,{data:$this.data.settings},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?$this.show_saved_message=!0:"error"===response.data.type&&($this.error_message=response.data.error_description,$this.show_error_message=!0):($this.error_message=tyche.bkap.return_label("axios_get_error"),$this.show_error_message=!0),$this.show_saving_loader=!1}).catch(function(error){$this.error_message=tyche.bkap.return_label("axios_get_error",error),$this.show_saving_loader=!1,$this.show_error_message=!0}),document.getElementById("bkap-page").scrollIntoView({behavior:"smooth",block:"start"})},show_add_season_page(){this.show_add_season_data_page=!0,setTimeout(()=>{tyche.bkap.choices_js.render_choices_js_elements("user_role",this.data.wp_roles,".bkap_choices_js_user_role")})},show_edit_season_page(index){this.data.add_season_data=this.data.settings.seasons_configuration_data[index],this.data.add_season_data.is_edit=!0,this.data.add_season_data.id=index,this.show_add_season_page(),setTimeout(()=>{"object"==typeof this.data.add_season_data.user_role&&null!==this.data.add_season_data.user_role&&this.data.add_season_data.user_role.forEach(key=>{tyche.bkap.choices_js.instances.user_role.setChoiceByValue(key)})})},hide_add_season_page(){this.show_add_season_data_page=!1,this.reset_season_data()},bulk_delete_season_data(){let ids=[];for(const key in this.data.settings.seasons_configuration_data)this.data.settings.seasons_configuration_data[key].is_checked&&ids.push(this.data.settings.seasons_configuration_data[key].season_id);0!==ids.length&&this.delete_season_data(ids)},delete_season_data(index){this.reset(),this.show_saving_loader=!0;let $this=this;jQuery(`#deleteModal_${index}`).modal("hide"),axios.post(`${tyche.bkap.rest_url()}seasonal-pricing/delete-season-data`,{id:index},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?($this.show_season_data_deleted_message=!0,$this.data.settings.seasons_configuration_data=response.data.seasons_configuration_data):"error"===response.data.type&&($this.error_message=response.data.error_description,$this.show_error_message=!0):($this.error_message=tyche.bkap.return_label("axios_get_error"),$this.show_error_message=!0),$this.show_saving_loader=!1}).catch(function(error){$this.error_message=tyche.bkap.return_label("axios_get_error",error),$this.show_saving_loader=!1,$this.show_error_message=!0}),document.getElementById("bkap-page").scrollIntoView({behavior:"smooth",block:"start"})},save_season_data(){let $this=this;var season_error_msg="";if(""==$this.data.add_season_data.season_name&&(season_error_msg+="<br>Season name value is empty."),""==$this.data.add_season_data.start_date&&(season_error_msg+="<br>Start date value is empty."),""==$this.data.add_season_data.end_date&&(season_error_msg+="<br>End date value is empty."),""==$this.data.add_season_data.price&&(season_error_msg+="<br>Amount/Percent value is empty."),""!==season_error_msg)return tyche.bkap.alert.error("Some errors have been found!",season_error_msg),!1;this.reset(),this.show_saving_loader=!0,this.show_add_season_data_page=!0;let is_edit=void 0!==this.data.add_season_data.is_edit;axios.post(`${tyche.bkap.rest_url()}seasonal-pricing/save-season-data`,{season_data:$this.data.add_season_data},{headers:{"X-WP-Nonce":bkap_params.nonce}}).then(function(response){void 0!==response.data?"success"===response.data.type?(is_edit?$this.show_season_data_updated_message=!0:$this.show_season_data_saved_message=!0,$this.reset_season_data(),$this.data.settings.seasons_configuration_data=response.data.seasons_configuration_data,$this.show_add_season_data_page=!1):"error"===response.data.type&&($this.error_message=response.data.error_description,$this.show_error_message=!0):($this.error_message=tyche.bkap.return_label("axios_get_error"),$this.show_error_message=!0),$this.show_saving_loader=!1}).catch(function(error){$this.error_message=tyche.bkap.return_label("axios_get_error",error),$this.show_saving_loader=!1,$this.show_error_message=!0}),document.getElementById("bkap-page").scrollIntoView({behavior:"smooth",block:"start"})},bulk_select_to_delete:function(){for(let value in this.data.settings.seasons_configuration_data){let data=this.data.settings.seasons_configuration_data[value];data.is_checked=!data.is_checked,Vue.set(this.data.settings.seasons_configuration_data,value,data)}}}});
